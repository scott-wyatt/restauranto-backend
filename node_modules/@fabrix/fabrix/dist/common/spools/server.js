"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const _1 = require("../");
const lodash_1 = require("lodash");
const spindleOptions = [
    'populate',
    'limit',
    'offset',
    'sort'
];
class ServerSpool extends _1.Spool {
    static get type() {
        return 'server';
    }
    constructor(app, config) {
        if (!config) {
            throw new Error('ServerSpool must be subclassed. Do not load it directly.');
        }
        super(app, config);
    }
    _parseQuery(data) {
        return lodash_1.mapValues(data, value => {
            if (value === 'true' || value === 'false') {
                value = value === 'true';
            }
            if (value === '%00' || value === 'null') {
                value = null;
            }
            const parseValue = parseFloat(value);
            if (!isNaN(parseValue) && isFinite(value)) {
                value = parseValue;
            }
            return value;
        });
    }
    getOptionsFromQuery(query) {
        return this._parseQuery(lodash_1.pick(query, spindleOptions));
    }
    getCriteriaFromQuery(query) {
        return this._parseQuery(lodash_1.omit(query, spindleOptions));
    }
}
exports.ServerSpool = ServerSpool;
